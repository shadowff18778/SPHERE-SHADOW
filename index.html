<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPHERE SHADOW - Accès Sécurisé</title>
    <!-- Chargement de Tailwind CSS pour un style moderne et responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuration de la police Inter (standard et lisible) et du thème rouge/sombre -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        :root {
            font-family: 'Inter', sans-serif;
        }
        /* Style global du corps en noir intense */
        body {
            background-color: #0d0d0d; /* Presque noir */
        }
        /* Animation de chargement spéciale (Sphère qui tourne) */
        @keyframes sphere-spin {
            0% { transform: rotate(0deg) scale(0.8); opacity: 1; }
            50% { transform: rotate(180deg) scale(1.1); opacity: 0.9; }
            100% { transform: rotate(360deg) scale(0.8); opacity: 1; }
        }
        .sphere-loader {
            width: 80px;
            height: 80px;
            border: 8px solid #330000; /* Bordure rouge très sombre */
            border-top-color: #e53e3e; /* Rouge vif pour l'animation */
            border-radius: 50%;
            animation: sphere-spin 1.5s linear infinite;
            filter: drop-shadow(0 0 10px rgba(229, 62, 62, 0.7)); /* Ombre rougeoyer */
        }
        /* Animation pour le spinner du bouton */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .button-spinner {
            animation: spin 1s linear infinite;
        }
        
        /* === NOUVEAU: CSS pour le compteur d'alerte rouge clignotant === */
        @keyframes blink-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }
        .lockout-warning {
            color: #f56565 !important; /* Rouge d'alerte vif */
            animation: blink-red 0.8s ease-in-out infinite;
            font-weight: bold;
        }
        /* === FIN NOUVEAU CSS === */
    </style>
</head>
<body class="min-h-screen flex flex-col justify-center items-center text-gray-100 p-4 transition-all duration-500">

    <!-- 1. MODALE DE CONSENTEMENT COOKIE (Apparaît une fois par semaine) -->
    <div id="cookie-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 transition-opacity duration-700 opacity-0 pointer-events-none">
        <!-- Rendu plus compact sur mobile (p-6, text-xl) -->
        <div class="bg-gray-800 border-2 border-red-700 rounded-xl shadow-2xl p-6 md:p-8 mx-4 w-full max-w-md transform transition-all duration-500 scale-95">
            <h2 class="text-xl sm:text-2xl font-bold text-red-400 mb-4 border-b border-red-800 pb-2">ACCÈS PROTOCOLE SHADOW</h2>
            <p class="text-gray-300 mb-6 text-sm sm:text-base">
                Pour maintenir la sécurité et l'expérience optimisée du réseau SPHERE SHADOW, nous utilisons des "cookies de session". Acceptez-vous le protocole ?
            </p>
            <div class="flex justify-end space-x-4">
                <button onclick="handleCookieAcceptance(false)" class="px-5 py-2 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition duration-300 shadow-md text-sm sm:text-base">
                    Refuser
                </button>
                
                <!-- BOUTON D'ACCEPTATION AVEC CHARGEMENT INTÉGRÉ -->
                <button onclick="handleCookieAcceptance(true)" id="accept-cookie-button" 
                        class="px-5 py-2 bg-red-800 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-300 shadow-lg shadow-red-900/50 relative overflow-hidden flex items-center justify-center min-w-[12rem] text-sm sm:text-base">
                    <span id="cookie-button-text">Accepter et Continuer</span>
                    
                    <!-- Le Loader qui apparaît sur le bouton -->
                    <span id="cookie-loader" class="absolute inset-0 bg-red-800 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 text-sm font-normal">
                        <svg class="button-spinner h-5 w-5 text-white mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                             <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.836 4.305c.291 1.255.438 2.544.438 3.824 0 4.418-3.582 8-8 8s-8-3.582-8-8c0-1.28.147-2.569.438-3.824m-4.882-1.571a.75.75 0 010-1.492.75.75 0 010 1.492zM20 12h2a10 10 0 00-20 0h2zm-8-8v2"></path>
                        </svg>
                        Analyse...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- 2. ÉCRAN DE CHARGEMENT STYLÉ (Utilisé pour l'initialisation et le téléchargement) -->
    <div id="loading-screen" class="fixed inset-0 bg-[#0d0d0d] flex flex-col items-center justify-center z-40 transition-opacity duration-500 opacity-0 pointer-events-none">
        <div class="sphere-loader"></div>
        <!-- Taille de texte adaptée au mobile (lg au lieu de xl) -->
        <p id="loading-text" class="mt-8 text-lg sm:text-xl font-mono text-red-500 tracking-wider text-center px-4">
            INITIATION DU PROTOCOLE (0%)...
        </p>
        <!-- Barre de progression adaptée à la largeur de l'écran -->
        <div class="w-full max-w-xs sm:max-w-md h-2 mt-4 bg-gray-800 rounded-full overflow-hidden">
            <div id="loading-bar" class="h-full bg-red-600 transform origin-left transition-transform duration-100" style="width: 0%;"></div>
        </div>
    </div>

    <!-- 3. PORTAIL D'ACCÈS SÉCURISÉ (Contenu principal) -->
    <div id="access-gate" class="flex flex-col items-center justify-center w-full max-w-xl p-8 bg-gray-900 border-2 border-red-900 rounded-xl shadow-2xl shadow-red-900/60 transition-opacity duration-500 opacity-0 pointer-events-none">
        <!-- Titre adapté: text-3xl sur mobile, text-5xl sur desktop -->
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-red-600 mb-6 tracking-wide">
            SPHERE SHADOW
        </h1>
        <!-- Sous-titre adapté: text-base sur mobile, text-lg sur desktop -->
        <p class="text-red-400 text-base sm:text-lg mb-4 text-center border-b border-red-800 pb-4 w-full">
            AUTHENTIFICATION REQUISE : CLÉ D'ACCÈS
        </p>
        
        <!-- Statut de Verrouillage/Tentatives adapté -->
        <p id="lockout-status" class="mt-2 mb-6 text-center text-red-500 font-mono text-base sm:text-lg min-h-[1.5rem]"></p>
        
        <form id="access-form" class="w-full">
            <input type="password" id="secret-code" placeholder="Entrez la clé secrète..." required
                   class="w-full p-4 mb-4 text-center bg-gray-800 border-2 border-red-700 rounded-lg text-white placeholder-red-300 focus:outline-none focus:ring-2 focus:ring-red-500 transition duration-300 text-xl tracking-widest shadow-inner shadow-black/50">

            <button type="submit"
                    class="w-full py-3 bg-red-700 text-white text-lg font-bold rounded-lg hover:bg-red-600 active:bg-red-800 transition transform duration-300 hover:scale-[1.02] shadow-xl shadow-red-900/70">
                ACTIVER LE PROTOCOLE
            </button>
        </form>

        <p id="message-box" class="mt-6 text-sm text-center text-red-400 min-h-[1.5rem] opacity-0 transition-opacity duration-300"></p>
    </div>

    <!-- 4. PAGE DE CONTENU (Après succès) - MAINTENANT PLEIN ÉCRAN AVEC TÉLÉCHARGEMENT -->
    <div id="success-content" class="absolute inset-0 opacity-0 pointer-events-none transition-opacity duration-500">
        <div class="h-full w-full flex flex-col bg-gray-900 border-2 border-red-700 shadow-2xl shadow-red-900/50">
            <!-- Bandeau de titre Dark Rouge adapté -->
            <header class="p-3 bg-red-900/40 border-b-2 border-red-700">
                <h2 class="text-lg sm:text-xl md:text-2xl font-extrabold text-red-400 tracking-wider text-center">
                    SPHERE SHADOW — FICHIERS SÉCURISÉS (MEDIAFIRE)
                </h2>
            </header>

            <!-- Contenu de Téléchargement -->
            <main class="flex-grow flex flex-col items-center justify-center p-8 text-center">
                <!-- Titre de téléchargement adapté -->
                <p class="text-xl sm:text-2xl md:text-3xl font-bold text-red-400 mb-6 px-2">
                    FICHIER SHADOW PRÊT AU TÉLÉCHARGEMENT
                </p>
                <p class="text-base sm:text-lg text-gray-300 mb-10 p-2 bg-gray-800 rounded-lg shadow-inner">
                    Nom du Fichier: SHADOW - John Wick 2014.mp4
                </p>

                <!-- Bouton de Téléchargement Stylé (Taille adaptée au mobile: w-28) -->
                <button id="download-button" onclick="startDownloadLoading()"
                        class="w-28 h-28 sm:w-32 sm:h-32 md:w-40 md:h-40 flex items-center justify-center bg-red-700 rounded-full shadow-2xl shadow-red-900/80 hover:bg-red-600 transition duration-300 transform hover:scale-105 active:scale-95 group relative overflow-hidden focus:outline-none">
                    
                    <!-- Icône de Téléchargement (Taille adaptée au mobile: w-12) -->
                    <svg class="w-12 h-12 sm:w-16 sm:h-16 text-white transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                </button>

                <p id="download-message" class="mt-6 text-sm text-center text-red-400 opacity-0 transition-opacity duration-300"></p>
            </main>

            <!-- Footer discret -->
            <footer class="p-1 bg-red-900/40 border-t-2 border-red-700 text-center text-xs text-red-500">
                Protocole activé. Données transmises via canal sécurisé.
            </footer>
        </div>
    </div>

    <script>
        // === Configuration et Variables Globales ===
        const ONE_WEEK_MS = 7 * 24 * 60 * 60 * 1000;
        const LOADING_DURATION_MS = 5000;
        const COOKIE_LOADING_DURATION_MS = 3000;
        const SECRET_CODES = ['95741', 'ERVIS', 'SHADOW1'];
        const STORAGE_KEY = 'lastCookieCheck';
        const DOWNLOAD_URL = 'https://download1324.mediafire.com/elrhudzhi7egOf-ywAD086yPBeBHmLuhno6u_x0bxmZ93dRdnt_AdYoqPUL_wJd7nfN6y8XmwZ7UbdZuHbmWjFNTtRc2kOVJVy-p09tl_y77cyvkxe30ukub3r5EkILF_YMNWReZ8J3-XyHgwWXonGnUOvp1_SU0BLZNRfZCpCQi/zmd22b97ksn9ibb/SHADOW+-+John+Wick+2014.mp4';
        
        // NOUVEAUX CONSTANTES POUR LE VERROUILLAGE
        const MAX_ATTEMPTS = 3;
        const LOCKOUT_DURATION_MS = 24 * 60 * 60 * 1000; // 24 heures
        const WARNING_TIME_MS = 3 * 60 * 60 * 1000; // 3 heures pour l'alerte rouge
        const ATTEMPTS_KEY = 'failedAttempts';
        const LOCKOUT_EXPIRY_KEY = 'lockoutExpiry';
        
        // === Références DOM ===
        const cookieModal = document.getElementById('cookie-modal');
        const acceptCookieButton = document.getElementById('accept-cookie-button');
        const cookieButtonText = document.getElementById('cookie-button-text');
        const cookieLoader = document.getElementById('cookie-loader');
        
        const accessGate = document.getElementById('access-gate');
        const loadingScreen = document.getElementById('loading-screen');
        const successContent = document.getElementById('success-content');
        const accessForm = document.getElementById('access-form');
        const secretCodeInput = document.getElementById('secret-code');
        const messageBox = document.getElementById('message-box');
        const loadingText = document.getElementById('loading-text');
        const loadingBar = document.getElementById('loading-bar');
        const downloadButton = document.getElementById('download-button');
        const lockoutStatusElement = document.getElementById('lockout-status'); // NOUVEAU

        let timerTimeoutId = null; // Pour gérer l'intervalle de mise à jour du compteur

        // === Fonctions de Contrôle de l'Affichage ===

        /** Gère l'affichage initial du modal de cookies. */
        function checkCookieConsent() {
            const lastCheck = localStorage.getItem(STORAGE_KEY);
            const now = Date.now();

            if (!lastCheck || (now - parseInt(lastCheck) > ONE_WEEK_MS)) {
                showModal(cookieModal);
            } else {
                showGate();
            }
        }

        /** Affiche un élément avec une animation fluide. */
        function showModal(element) {
            element.classList.remove('pointer-events-none', 'opacity-0');
            requestAnimationFrame(() => {
                element.classList.add('opacity-100');
                const modalContent = element.querySelector('div');
                if (modalContent && modalContent.classList.contains('scale-95')) modalContent.classList.remove('scale-95');
            });
        }

        /** Cache un élément avec une animation fluide. */
        function hideModal(element, callback) {
            const modalContent = element.querySelector('div');
            if (modalContent && modalContent.classList.contains('scale-95')) modalContent.classList.add('scale-95');

            element.classList.remove('opacity-100');
            element.classList.add('opacity-0');

            setTimeout(() => {
                element.classList.add('pointer-events-none');
                if (callback) callback();
            }, 700);
        }

        /** Gère le clic sur Accepter/Refuser les cookies. */
        window.handleCookieAcceptance = function(accepted) {
            if (accepted) {
                // ACCEPTÉ: 3s de chargement, enregistrement, puis passage à la porte d'accès.
                acceptCookieButton.disabled = true;
                cookieButtonText.style.visibility = 'hidden';
                cookieLoader.classList.remove('pointer-events-none', 'opacity-0');
                cookieLoader.classList.add('opacity-100');

                setTimeout(() => {
                    localStorage.setItem(STORAGE_KEY, Date.now());
                    hideModal(cookieModal, showGate);
                }, COOKIE_LOADING_DURATION_MS);

            } else {
                // REFUSÉ: Rediriger immédiatement vers Google.
                window.location.href = 'https://www.google.com/';
            }
        }

        /** Convertit les millisecondes en format H:MM:SS. */
        function msToTime(duration) {
            let seconds = Math.floor((duration / 1000) % 60);
            let minutes = Math.floor((duration / (1000 * 60)) % 60);
            let hours = Math.floor((duration / (1000 * 60 * 60)));

            hours = (hours < 10) ? "0" + hours : hours;
            minutes = (minutes < 10) ? "0" + minutes : minutes;
            seconds = (seconds < 10) ? "0" + seconds : seconds;

            return hours + ":" + minutes + ":" + seconds;
        }

        /** Met à jour le compteur de verrouillage en direct et gère l'effet d'alerte. */
        function updateLockoutTimer() {
            const expiryTime = localStorage.getItem(LOCKOUT_EXPIRY_KEY);
            if (!expiryTime) {
                // Si pas d'expiration, efface le statut et arrête la boucle
                lockoutStatusElement.textContent = '';
                lockoutStatusElement.classList.remove('lockout-active', 'lockout-warning');
                return;
            }

            const remainingTime = parseInt(expiryTime) - Date.now();

            if (remainingTime <= 0) {
                // Verrouillage expiré
                localStorage.removeItem(LOCKOUT_EXPIRY_KEY);
                localStorage.removeItem(ATTEMPTS_KEY);
                checkLockoutStatus(); // Recheck pour réactiver l'accès
                return;
            }

            // Affichage du compteur
            const timeString = msToTime(remainingTime);
            lockoutStatusElement.textContent = `ACCÈS BLOQUÉ. Reconnexion dans ${timeString}`;
            
            // Effet d'alerte rouge clignotant
            if (remainingTime < WARNING_TIME_MS) {
                lockoutStatusElement.classList.add('lockout-warning');
            } else {
                lockoutStatusElement.classList.remove('lockout-warning');
            }

            // Met à jour dans 1 seconde
            timerTimeoutId = setTimeout(updateLockoutTimer, 1000);
        }
        
        /** Vérifie si l'utilisateur est verrouillé et met à jour l'état de la porte d'accès. */
        function checkLockoutStatus() {
            // Arrête le timer précédent pour éviter les boucles multiples
            if (timerTimeoutId) clearTimeout(timerTimeoutId); 
            
            const expiryTime = localStorage.getItem(LOCKOUT_EXPIRY_KEY);
            const attempts = parseInt(localStorage.getItem(ATTEMPTS_KEY) || 0);
            const accessButton = accessForm.querySelector('button[type="submit"]');

            if (expiryTime && parseInt(expiryTime) > Date.now()) {
                // Utilisateur est VERROUILLÉ
                secretCodeInput.disabled = true;
                accessButton.disabled = true;
                accessButton.textContent = "VERROUILLÉ";
                
                displayMessage("Le protocole de sécurité est activé. Tentative d'intrusion détectée.", true);
                
                // Démarre le compte à rebours en direct
                updateLockoutTimer();
                return true;
            } else {
                // Utilisateur n'est PAS verrouillé
                localStorage.removeItem(LOCKOUT_EXPIRY_KEY); // Nettoie si le lock a expiré
                
                secretCodeInput.disabled = false;
                accessButton.disabled = false;
                accessButton.textContent = "ACTIVER LE PROTOCOLE";
                
                lockoutStatusElement.classList.remove('lockout-warning');

                // Affiche le nombre de tentatives s'il y en a
                if (attempts > 0) {
                    lockoutStatusElement.textContent = `Tentative d'accès: ${attempts}/${MAX_ATTEMPTS}`;
                } else {
                    lockoutStatusElement.textContent = '';
                }
                return false;
            }
        }

        /** Affiche le portail d'accès au contenu (la page principale). */
        function showGate() {
            accessGate.classList.remove('opacity-0', 'pointer-events-none');
            accessGate.classList.add('opacity-100');
            checkLockoutStatus(); // Vérifie l'état de sécurité
        }
        
        /** Déclenche et gère l'écran de chargement de 5 secondes (pour l'initialisation). */
        function startLoading() {
            hideModal(accessGate);
            showModal(loadingScreen);

            let start = Date.now();
            let timer = 0;
            const interval = 50; 
            
            loadingText.textContent = `INITIATION DU PROTOCOLE (0%)...`;

            const loadingInterval = setInterval(() => {
                timer = Date.now() - start;
                let progress = Math.min(100, Math.floor((timer / LOADING_DURATION_MS) * 100));

                loadingBar.style.width = `${progress}%`;
                loadingText.textContent = `INITIATION DU PROTOCOLE (${progress}%)...`;

                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    showSuccessPage();
                }
            }, interval);
        }
        
        /** Déclenche et gère l'écran de chargement de 5 secondes (pour le téléchargement). */
        window.startDownloadLoading = function() {
            downloadButton.disabled = true;
            
            hideModal(successContent);
            showModal(loadingScreen);

            let start = Date.now();
            let timer = 0;
            const interval = 50; 
            
            loadingText.textContent = `PRÉPARATION DU TÉLÉCHARGEMENT SÉCURISÉ (0%)...`;

            const loadingInterval = setInterval(() => {
                timer = Date.now() - start;
                let progress = Math.min(100, Math.floor((timer / LOADING_DURATION_MS) * 100));

                loadingBar.style.width = `${progress}%`;
                loadingText.textContent = `PRÉPARATION DU TÉLÉCHARGEMENT SÉCURISÉ (${progress}%)...`;

                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    // Redirection après le chargement
                    window.location.href = DOWNLOAD_URL;
                }
            }, interval);
        }


        /** Affiche le contenu final (page de téléchargement). */
        function showSuccessPage() {
            hideModal(loadingScreen);
            showModal(successContent);
            if (downloadButton) downloadButton.disabled = false;
        }

        /** Affiche un message d'erreur ou de succès temporaire. */
        function displayMessage(text, isError = false) {
            messageBox.textContent = text;
            messageBox.classList.remove('text-red-400', 'text-green-400');
            messageBox.classList.add(isError ? 'text-red-400' : 'text-green-400');
            messageBox.classList.add('opacity-100');

            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
            }, isError ? 3000 : 1500);
        }

        // === Écouteur d'événement pour le formulaire d'accès ===
        accessForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Vérifie le verrouillage AVANT de traiter la tentative
            if (checkLockoutStatus()) {
                return; 
            }
            
            const inputCode = secretCodeInput.value.trim().toUpperCase();

            // Vérification sécurisée des codes
            if (SECRET_CODES.includes(inputCode)) {
                // --- SUCCÈS ---
                localStorage.removeItem(ATTEMPTS_KEY); // Réinitialise les tentatives
                localStorage.removeItem(LOCKOUT_EXPIRY_KEY); // Enlève le verrou
                lockoutStatusElement.textContent = '';
                
                displayMessage("ACCÈS AUTORISÉ. Préparation...", false);
                startLoading();
            } else {
                // --- ÉCHEC ---
                let attempts = parseInt(localStorage.getItem(ATTEMPTS_KEY) || 0) + 1;
                localStorage.setItem(ATTEMPTS_KEY, attempts);

                secretCodeInput.value = ''; // Efface le champ

                if (attempts >= MAX_ATTEMPTS) {
                    // Verrouillage déclenché
                    const expiryTime = Date.now() + LOCKOUT_DURATION_MS;
                    localStorage.setItem(LOCKOUT_EXPIRY_KEY, expiryTime);

                    displayMessage("CLÉ INVALIDE. ACCÈS TEMPORAIREMENT BLOQUÉ (24h).", true);
                    checkLockoutStatus(); // Active le timer et verrouille les inputs
                } else {
                    // Échec, pas encore verrouillé
                    displayMessage("CLÉ D'ACCÈS INVALIDE. Tentative enregistrée.", true);
                    lockoutStatusElement.textContent = `Tentative d'accès: ${attempts}/${MAX_ATTEMPTS}`;
                }
            }
        });


        // === Démarrage de l'Application ===
        window.onload = checkCookieConsent;

    </script>
</body>
</html>
